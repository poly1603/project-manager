{"version":3,"sources":["../src/project-manager.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["/**\r\n * 项目管理器\r\n * \r\n * 提供项目信息检测、依赖管理等功能\r\n */\r\n\r\nimport { execa } from 'execa'\r\nimport fs from 'fs-extra'\r\nimport path from 'node:path'\r\nimport type {\r\n  ProjectType,\r\n  PackageManager,\r\n  ProjectConfig,\r\n  ProjectInfo,\r\n  ProjectManagerConfig,\r\n} from './types'\r\n\r\n/**\r\n * 项目管理器类\r\n */\r\nexport class ProjectManager {\r\n  private config: ProjectManagerConfig\r\n\r\n  constructor(config: ProjectManagerConfig = {}) {\r\n    this.config = {\r\n      verbose: config.verbose ?? false,\r\n      ...config,\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 检测项目类型\r\n   */\r\n  async detectProjectType(projectRoot: string): Promise<ProjectType> {\r\n    try {\r\n      const packageJsonPath = path.join(projectRoot, 'package.json')\r\n      \r\n      if (!await fs.pathExists(packageJsonPath)) {\r\n        return 'unknown'\r\n      }\r\n\r\n      const packageJson = await fs.readJson(packageJsonPath)\r\n      const deps = {\r\n        ...packageJson.dependencies,\r\n        ...packageJson.devDependencies,\r\n      }\r\n\r\n      // 按优先级检测框架\r\n      if (deps['nuxt'] || deps['nuxt3']) return 'nuxt'\r\n      if (deps['next']) return 'next'\r\n      if (deps['@remix-run/react']) return 'remix'\r\n      if (deps['astro']) return 'astro'\r\n      if (deps['vue'] || deps['@vue/cli-service']) return 'vue'\r\n      if (deps['react'] || deps['react-dom']) return 'react'\r\n      if (deps['@angular/core']) return 'angular'\r\n      if (deps['svelte']) return 'svelte'\r\n      if (deps['solid-js']) return 'solid'\r\n      if (deps['@builder.io/qwik']) return 'qwik'\r\n      if (deps['lit']) return 'lit'\r\n      if (deps['preact']) return 'preact'\r\n\r\n      return 'unknown'\r\n    } catch (error) {\r\n      this.log(`Failed to detect project type: ${error}`)\r\n      return 'unknown'\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 检测包管理器\r\n   */\r\n  async detectPackageManager(projectRoot: string): Promise<PackageManager> {\r\n    try {\r\n      // 检查 lock 文件\r\n      if (await fs.pathExists(path.join(projectRoot, 'pnpm-lock.yaml'))) {\r\n        return 'pnpm'\r\n      }\r\n      if (await fs.pathExists(path.join(projectRoot, 'yarn.lock'))) {\r\n        return 'yarn'\r\n      }\r\n      if (await fs.pathExists(path.join(projectRoot, 'bun.lockb'))) {\r\n        return 'bun'\r\n      }\r\n      if (await fs.pathExists(path.join(projectRoot, 'package-lock.json'))) {\r\n        return 'npm'\r\n      }\r\n\r\n      // 检查 package.json 中的 packageManager 字段\r\n      const packageJsonPath = path.join(projectRoot, 'package.json')\r\n      if (await fs.pathExists(packageJsonPath)) {\r\n        const packageJson = await fs.readJson(packageJsonPath)\r\n        if (packageJson.packageManager) {\r\n          const pm = packageJson.packageManager.split('@')[0]\r\n          return pm as PackageManager\r\n        }\r\n      }\r\n\r\n      // 默认返回 npm\r\n      return 'npm'\r\n    } catch (error) {\r\n      this.log(`Failed to detect package manager: ${error}`)\r\n      return 'npm'\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 检测是否为 monorepo\r\n   */\r\n  async isMonorepo(projectRoot: string): Promise<boolean> {\r\n    try {\r\n      const packageJsonPath = path.join(projectRoot, 'package.json')\r\n      \r\n      if (!await fs.pathExists(packageJsonPath)) {\r\n        return false\r\n      }\r\n\r\n      const packageJson = await fs.readJson(packageJsonPath)\r\n      \r\n      // 检查是否有 workspaces 字段\r\n      if (packageJson.workspaces) {\r\n        return true\r\n      }\r\n\r\n      // 检查是否有 pnpm-workspace.yaml\r\n      if (await fs.pathExists(path.join(projectRoot, 'pnpm-workspace.yaml'))) {\r\n        return true\r\n      }\r\n\r\n      // 检查是否有 lerna.json\r\n      if (await fs.pathExists(path.join(projectRoot, 'lerna.json'))) {\r\n        return true\r\n      }\r\n\r\n      return false\r\n    } catch (error) {\r\n      this.log(`Failed to check monorepo: ${error}`)\r\n      return false\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取项目配置\r\n   */\r\n  async getProjectConfig(projectRoot: string): Promise<ProjectConfig> {\r\n    const packageJsonPath = path.join(projectRoot, 'package.json')\r\n    const packageJson = await fs.readJson(packageJsonPath)\r\n\r\n    const type = await this.detectProjectType(projectRoot)\r\n    const packageManager = await this.detectPackageManager(projectRoot)\r\n    const isMonorepo = await this.isMonorepo(projectRoot)\r\n\r\n    const config: ProjectConfig = {\r\n      name: packageJson.name || path.basename(projectRoot),\r\n      type,\r\n      root: projectRoot,\r\n      packageManager,\r\n      packageJson,\r\n      isMonorepo,\r\n    }\r\n\r\n    if (isMonorepo && packageJson.workspaces) {\r\n      config.workspaces = Array.isArray(packageJson.workspaces)\r\n        ? packageJson.workspaces\r\n        : packageJson.workspaces.packages || []\r\n    }\r\n\r\n    return config\r\n  }\r\n\r\n  /**\r\n   * 获取项目信息\r\n   */\r\n  async getProjectInfo(projectRoot: string): Promise<ProjectInfo> {\r\n    const config = await this.getProjectConfig(projectRoot)\r\n\r\n    return {\r\n      config,\r\n      dependencies: {\r\n        prod: config.packageJson.dependencies || {},\r\n        dev: config.packageJson.devDependencies || {},\r\n      },\r\n      scripts: config.packageJson.scripts || {},\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 运行脚本命令\r\n   */\r\n  async runScript(projectRoot: string, scriptName: string): Promise<void> {\r\n    const config = await this.getProjectConfig(projectRoot)\r\n    const pm = config.packageManager\r\n\r\n    this.log(`Running script \"${scriptName}\" with ${pm}...`)\r\n\r\n    await execa(pm, ['run', scriptName], {\r\n      cwd: projectRoot,\r\n      stdio: 'inherit',\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 安装依赖\r\n   */\r\n  async install(projectRoot: string): Promise<void> {\r\n    const config = await this.getProjectConfig(projectRoot)\r\n    const pm = config.packageManager\r\n\r\n    this.log(`Installing dependencies with ${pm}...`)\r\n\r\n    await execa(pm, ['install'], {\r\n      cwd: projectRoot,\r\n      stdio: 'inherit',\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 日志输出\r\n   */\r\n  private log(message: string): void {\r\n    if (this.config.verbose) {\r\n      console.log(`[ProjectManager] ${message}`)\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * 创建项目管理器实例\r\n */\r\nexport function createProjectManager(config?: ProjectManagerConfig): ProjectManager {\r\n  return new ProjectManager(config)\r\n}\r\n"]}